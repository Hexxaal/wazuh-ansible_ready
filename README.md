# Wazuh Single-Node Docker Ansible Project

## Overview
This Ansible project deploys Wazuh in single-node Docker using the wazuh-docker repo (v4.12.0) and configures HTTPS with a Cloudflare Origin CA certificate.

## Vault Setup
Encrypt your Cloudflare Origin CA certs and key with your existing vault password file:
```bash
ansible-vault encrypt_string '<your PEM certificate>' --name 'cloudflare_origin_cert' --vault-password-file /home/dimitri/.vault_pass.txt
ansible-vault encrypt_string '<your PEM private key>' --name 'cloudflare_origin_key' --vault-password-file /home/dimitri/.vault_pass.txt
```
This will update `group_vars/all/vault.yml` with encrypted variables.

## Usage
1. Install dependencies:
   ```bash
   ansible-galaxy collection install community.docker
   ```
2. Run the playbook:
   ```bash
   ansible-playbook playbook.yml --vault-password-file /home/dimitri/.vault_pass.txt
   ```

## Variables
- `wazuh_repo_dest`: Path where wazuh-docker is cloned (default `/opt/wazuh-docker`).
- `cloudflare_origin_cert` & `cloudflare_origin_key`: Certificate and key injected via Vault.




ansible-vault encrypt_string '\
-----BEGIN CERTIFICATE-----
MIIEmzCCA4OgAwIBAgIUH06FDH1y+Z29jlyXSBNkCSvYCc8wDQYJKoZIhvcNAQEL
BQAwgYsxCzAJBgNVBAYTAlVTMRkwFwYDVQQKExBDbG91ZEZsYXJlLCBJbmMuMTQw
MgYDVQQLEytDbG91ZEZsYXJlIE9yaWdpbiBTU0wgQ2VydGlmaWNhdGUgQXV0aG9y
aXR5MRYwFAYDVQQHEw1TYW4gRnJhbmNpc2NvMRMwEQYDVQQIEwpDYWxpZm9ybmlh
MB4XDTI1MDcwNzA5MzMwMFoXDTQwMDcwMzA5MzMwMFowYjEZMBcGA1UEChMQQ2xv
dWRGbGFyZSwgSW5jLjEdMBsGA1UECxMUQ2xvdWRGbGFyZSBPcmlnaW4gQ0ExJjAk
BgNVBAMTHUNsb3VkRmxhcmUgT3JpZ2luIENlcnRpZmljYXRlMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEArnu/u30FLfTAAa/V4ciei94ugZTb6j+vkaD6
HTDKQcY6dtMBIiKsU9jobSA54EZyubItj28VqwhnUK6/T5Pr7bXcYZHeHjSVEZ6k
6jWO3PHlwjVv8FSz4tcVlQ3ZOsNAU/Z24CNvopbJYgR9awi3549d0qR6KtL3ywaB
y5Jni+tKz7NNyYK5Np4/b9rdHlYFLdvjr2qS3sSrjOfFqeoIhS2SOcaIp0+Jdv/n
eVhkJskl73rKbStmdXuoXMIgY4F1kM++7Cr6sDnOXiOffRWQGwct0TUKFfLHXcGW
9dD6rzJnEbFOH73fu9zg1qTEDZLNseBYI6zocHuP38sgtAVqswIDAQABo4IBHTCC
ARkwDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcD
ATAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBQxfGS9uBqapQNQ8Dgb72ijMHH4mTAf
BgNVHSMEGDAWgBQk6FNXXXw0QIep65TbuuEWePwppDBABggrBgEFBQcBAQQ0MDIw
MAYIKwYBBQUHMAGGJGh0dHA6Ly9vY3NwLmNsb3VkZmxhcmUuY29tL29yaWdpbl9j
YTAeBgNVHREEFzAVghN3YXp1aC5zZW50aWNvcmQub3JnMDgGA1UdHwQxMC8wLaAr
oCmGJ2h0dHA6Ly9jcmwuY2xvdWRmbGFyZS5jb20vb3JpZ2luX2NhLmNybDANBgkq
hkiG9w0BAQsFAAOCAQEAsbxOVkiA0ByOI3Qs5XxzjzE32KybF0MvKDssA/XUTXya
oNo7S5dRzolp9XL7reYxny+SEB6tUijL5y5irBJ1dVSmioqAxT39H0ZeATu4i+CR
+t5o1u1TeITGHStBFkiTkeMcALqJOdjI5z562QQBUMQCxzrvoRq/5bMOW+x7T8ce
DRyaFgf9PudVAxpeXtMN78erjU3+a0P7pOyipETA7ld+ptmEdDlv8eh+WqQhqkzl
/N0I4iiiU6YefAZRkIqKfLdwXaiziNJIDSjsg/nhTTgViIBw50LX7SM+JmGeHVsq
ibL19O8SUkO23w3Xo+eQGaLsTHvSu9QK8zPdnmVzmw==
-----END CERTIFICATE-----' \
  --name 'cloudflare_origin_cert' \
  --vault-password-file /home/dimitri/.vault_pass.txt


  --name 'cloudflare_origin_cert' \
  --vault-password-file /home/dimitri/.vault_pass.txt
cloudflare_origin_cert: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37343263393137333462666430393665633565616538643830373639343465353535626264363262
          3530376233306334636132373664396135633937353766370a616164353935626366366138343361
          36373164613662636262363130343066346531646165623262376161663932613563313337376532
          3761313233383037340a613566303232376364336331323335343463353138613138383166303530
          31633534363333323362346136626364306137313334613838666137386639356430353833386333
          33323265316363653434643166383535356230316539333966643736646332376563613436383331
          34306538616432396362306537333132306366666662313731613330663337353964623136356663
          35303637356362333762656165363733333932346235306464356234333762646165393531373634
          33373931613639343264356136343966623434616466623334633664346439333463633333663334
          64316564636439623533373339643162636561616532636439613938323766643930343264616437
          61653637666461623839623431366137636561623137633533326465656663653130643436666166
          36386361643739646565383033313737643139333038346238396465666565303838626363393961
          30383064346331656566623831313264313633636265383232643930313364376665303664333736
          33303033663333666439623838646139643239633130393332623531626335326664313135316137
          32663766373938346261613636363632303032613566666537663037623836626332623336396661
          61316161383565626634343532656363643336623562646261383364653036373165653762376535
          32383931343936343866356362316437373263313136386534616237626638363634396235363530
          31343866653065306534386261616130326133643934393563646234376438333561326138643632
          37633537326531336433626462613265626438626135313862333035636136353439393661333863
          66653838663966373638636438386462613935373639666636663333643766363032616262306432
          37663436326534326234623031663037336361333135663433383462386366333261653263623839
          36623635323662333236393962646664383862626665643763383634623065626634313538373530
          36353532633764383764616630343665353535623738333734376432303634386230333337346138
          35313963636335306237666136643666313836376261396563623636336237323333666633373030
          33623634653061383333653261323963303531356165313861373839306165393436656264656164
          36313966636664653030343033373638613834303933373439616662303430386532373032646338
          39353337663438363631306637393062373163663564633639636135346332383131346265393263
          35306239636139353236343638333237363963366562626233303264353438666434353235663764
          34653166656535383831633530346239623633326334306236326336353633386565356536643562
          36663134363039633431316630393336336133386330333332366335393935346135643864363766
          65376238383535663166613634383065653831633931306138356230333033326338336263373134
          37306261666132353033626236393434333534396563666636653238386233656135363734393466
          66393539383637363866383632643561323635646535663961623934346366363636393734363232
          32383565643233633330303034353730323330353530303966633165633764393230366630366336
          33393061323439666565653766626134316139633063306434336631353266653332386239643236
          62393838366663626638666530666532353265356165653734363036613864353334343935346366
          38623762363734313666323262393034333733653239663932353765653939633563363835393566
          31306364353531333732383635333962613565613830323661363962363064626564653765313139
          32376162613239316262653136666433303264626530653330333861303337393164346430393964
          30663535343636323063353761386263393633653436326335353561653761306662376533336339
          39616264656638623933646335393737306233663433646164323661303933386664653364306662
          34306163623132326666626638323637303332393032653962346262616333623762616638386134
          37636234613766376535383861303966623566386332396161363334626430623233396163343637
          65386163646434623066633435636535653662636530316664616662653862376363346634366437
          64616662396330643337393438613238643239313862383838306230643038376339303066616165
          30343031353931633837303239313236623765663935346433366466376336346166626339613335
          37376638353831633762396633636162313238313861616330373662376535396532616364393866
          39326364623165613164653566363830386263613938613962323565633965306564353236623335
          32316364376536623036366637323765313833373334653730666562313939376666396233633936
          66363366343231383736656261353535633362343730643639323762636165383663316134346563
          66616134393339346331643035353737336566323234343236396463393265663464383662653462
          35373433396538316466366339656231663163653431356563643535646432306331646339353536
          35366638336630383766386430383461363331643239386162306531616161363833336536313036
          39376539666364303136303431366235303133306431643232663836326438306431333264633365
          31373432323933376634656261336438643339393266353632333539323537353034393166353234
          63333663343137616139613832653062636364613862646463376436333762366432623866303262
          61356432343636613333306132326165633665633363653538333466323430623566386663353764
          36633666633362386538313231393232363135646331326361663933313462333833313465666639
          61303662633237356338653265353566373363653461366236326236316433633336643434373030
          38363065323432623836646531663535663436633762363939643964636361363532336261363164
          61393135343961623932616261363232613265663930373461333035316339393662336433343932
          37306639306163363536653339393863656339316333613237613631623135613961666336316531
          64383963376435373536623836323164643961666236626338366261393864366136306230373134
          62356666643864386266336630306635326132333361363661326164303738356435393832346236
          36613437353432356463303335636538636363393163313637313763373834333363343635386536
          37656434373461653238613761383361363066636339306366353665616238313038316438346630
          34633861323738393939356638313366306165313964633539396238383030313261643165386637
          61373133366466663434333932636665383861366666326432646336613337353937316263373832
          31313035623465396532666366636463323362646636353130396161363739303439353061323333
          30666662356136396533313536306565346163396633613734343365343436306434306166393732
          62323265383436633131633531376136366537313865303831333034323130663830373963323530
          64373338396437613363353134393861646530373865663734343964306166633363613738376136
          39313861616230383831323861356665633365346664623935316431306265656661653438366434
          66376533663737313738376130386265636366663035303239663836636566363630313565323766
          33636530356532393036333861386562623131343036653836336133363132666235353966396361
          33663462653933616665386535333439303266303061643331383965656138313538373138343864
          37656637653939666563643632396136336363653332666261666235373961623765373636383362
          31373439633262363339383332663534623138666361306434333261323966653235616430393335
          66616533656237643465306136313632386464396438626131376630656665633061383130396636
          38383331353139616236656132313130626239323336663363363662666234393163323463313237
          31313665353237343265393238623237643465356131333564613634663737623861343866393964
          66346563633363373531653234663332313333623537343638323863323230333366303362616637
          34663434386662383934666330633066386338373961363466363566373737303362333832333434
          30393939356137386536653033313161363339333265323638346232653830613531356430396331
          63643839646337356466666334383465306435636262356266663138363461346364396136666133
          31356266323561366635383764313530373237393938383835323463313365336338333736393130
          346435393839663736646633643237313831
Encryption successful



  --name 'cloudflare_origin_key' \tri/.vault_pass.txt
  --vault-password-file /home/dimitri/.vault_pass.txt
cloudflare_origin_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32653530646664666430373037333739663437313964663836323364356663333339636635386333
          3432626336323135633861633338616661613730633065380a303936303533343964636164626232
          37343334333536326662393364626332656466343436646236363833393766643365356264633639
          3865326439613861390a653565303432333131386633646633303062663038353461336232663436
          37333639626338656437306130663034376430633432633734326534323534333638393066353730
          66656365666465346661363636383039313631383037643135393539383861376164666336353162
          30623964636666333733346635613066393139326531333363383832353865373636646537393630
          38663063393732343633633432623036306132323332656337366438323331373130653037343339
          66343365633961643361636130386361373230323961313434643264383562383237333239393332
          65366137643539306630373136613461646130613165346533346136326438643836313637383831
          30326637636664353838613964653332393565343564393265383162623937306530386536633031
          30633766313433353630653763373065356538623435366235386630386266613135353464613639
          61323061366639323232616236623366343138306638323364363563386135376163343031363939
          63636231326464316465323063373863356232383331363664613837393064373765393964373034
          61353362363838626431393335303865663633636437333265333836663935333433376433373432
          65666331333737396461316566303338613836643261653334646232303162343632326135303637
          61373232613531373638333135323764666532383530323730313662366437616137326235643330
          38303065343933313430333132633964343235626339353066386564386537386135653562643664
          30353562363266353038656164333165643133343735616538363032636261633039316331383734
          32663063646431363337616263613839623965303335306266336165623432326463353034373662
          66323462646638383237613763653865353135333665643338393535646365623866373264326130
          64343038313636623639356431366331663535333362376234363833333737313533373536343965
          31313839343135326532313834633332656635666538383562393463336665653561616132373665
          63366531363732656138633562336361653565353335383562343032646164373533333838623733
          35616230303037313763313239323737323937323839363135653937306333303566346639613262
          36353162633966353831356337343135386630643538316330623435303039393839613161613163
          35303263633633326533373131303832643133633639303566336363616637646339623265356434
          34393936313863343332646139623439356532653764343162343232343635336635346136666638
          61393265306635353964653439646632326530363739363839376338653830343630623538613735
          39303233386636383839656436343265646334333131393962353230613331393265316633313464
          66656433353864343531323433656565353565386533656434313332376537323638613636396534
          39396261356663643935633434303764646363353161363063343131333033373539343432306431
          66633733303366316531363264353232643662306164313363663361366561356666336333653637
          61626261643139336238666538353332333566393832666632336637623063343935353838666165
          62666265376336623136636330333332303132373330366261646634643333306435616138303838
          62613136303464303736323633306266336134333635313239643466353933393261383965393437
          62623734366163373565336462343162653666373366306363366133396336626663366639666261
          38623036626163623530393162626566313631643735323266346132376535653933383433616431
          62383538306335346332383932343537376539616239356637356664346232663062353033663732
          66313763666564613763393338383038383334383234306463646266646163366235656138316434
          33633735386361643133376139643932363635653934363733303237616636396135396364623136
          62336463383862663133393537336436356664363363356430303630643463626337356665343266
          35613762333831343963333666653166616562306461363961326132643434303031343164383035
          35303333393164343530353663666534343836326261396564643736643762383535373662316332
          31643061366538636331393135343635386330313239346630393839386631613039666330393361
          32623836353065333039616435663730366232386266643664383163656163333034316462663966
          32336333393530343462663765653561363932613862313736613933353332386433316665383834
          36356262313366613937353461626661616139336461333765373362636336356234636536646130
          36323237633433623738343661333166303535353664303165393836633265633463393133313962
          65393637363239336665376261373862633232333130663462653661303765326639396162343036
          35663765356630663838643538653365366133616334393663363165663634366562376630346637
          62666364373036363565373761326261353138356361336234383335366438373130663338366138
          33646331623635623635613130386137353137333665333036393833333635386261346434626234
          66313734306237383939613231663432326434666335656435333561346261383134373263653061
          33383138666635386263363763646333623434343937343162653664346338616438663432383839
          64396535376562343762386263326562616630633030346461333362386634303235333830643531
          36653863326663613361663938633834396662326261306330346163323263663365656636346361
          62343138626631383331346664386137653637663136356637666539313539326133623739373830
          34353431623432373339316134303335646333316563643138326230356539343432306436363262
          37356666336331346266313533343638633066303438353265636661653636313435353830346364
          33326637346436336365373461623962316163373666663936373734333533306335343736336562
          30363164306238336535343134363535626363626665396632376339663763363965656265326161
          35633838653734623865333939333735633530613861623565323735386361666232343161653966
          34636436373761376462373836376631313937356561643932386132343132616462373138306661
          34336235656234663334393532333039343533363935356264643166626533353638633663316264
          33363161336637326236373630353132663463623939616438326433326266643732353262396666
          34343336383537343364373963636462643231313064626337666563333538323237313639396437
          63363332353765333464666465306163663065383965623138383566346361623338346132653466
          62646237373066643664636261396532653037343266333237383038366563346336643565373537
          31346432653236316435323338653631653666353033363961633631303539656662303430616132
          31376533323433313131333732373232376332393339333837386338323664643365343164363863
          39656435613635356138393436333165356462616334643764666634393536343635626130313464
          32336366383262313336353964653066373030396135373137336136646363353231633438336265
          63666436383930666662373033613364626464633163363663373166306664663161313961353066
          37363136376331663030306162356434363936306664313932373431623333663633636533616365
          64376464303335346639653336376639393633646232346530663232333264383337353365323130
          36346464376336306137363035306663303736376530376263343133643231653333336334633638
          39363036313865333333373937323739663736353865666561376137333831393334326436383735
          36303166306165613662346537376439383261393066656231353562393038326237383961383835
          35656137666366363861336563333537616630376366616266626335386563663031383162353066
          31393962313866656335623731623830356636633062663932663635643463343835356461383834
          33623131653937363633363535363134333265643237343265616438393836393930313533386464
          37613831626664363838373362613236396566613466356261623362653937613461393138346234
          32646633323532646136393866646138323239613237643763633937633835393933383435383030
          35643137396638306230646536383763623239383939353235643065663261656530343434636331
          38326539353931363333306264353933363031666563366361383036653233623637373062383837
          63393434653039643737393763373165383161626365643932343938343736653064613030356535
          35386564376636646361353061346235626262633861373137316136373334336664623965353233
          65396633613430373437306632623066386138633635323733396461383134393633
Encryption successful


ansible-vault encrypt_string '\
-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCue7+7fQUt9MAB
r9XhyJ6L3i6BlNvqP6+RoPodMMpBxjp20wEiIqxT2OhtIDngRnK5si2PbxWrCGdQ
rr9Pk+vttdxhkd4eNJURnqTqNY7c8eXCNW/wVLPi1xWVDdk6w0BT9nbgI2+ilsli
BH1rCLfnj13SpHoq0vfLBoHLkmeL60rPs03Jgrk2nj9v2t0eVgUt2+OvapLexKuM
58Wp6giFLZI5xoinT4l2/+d5WGQmySXvesptK2Z1e6hcwiBjgXWQz77sKvqwOc5e
I599FZAbBy3RNQoV8sddwZb10PqvMmcRsU4fvd+73ODWpMQNks2x4FgjrOhwe4/f
yyC0BWqzAgMBAAECggEACQLk7v4KdfClhMP78MDBO3ahAg1AYsBuRPNCgTgJwhlG
rLT1SO0i531IDiONCagc+O00WcUoojnGLpsP0CbS5DOxXl9y6fsL1d1sWMvYuIPm
IPN/xMxDGOYqonuU6mpQfxjQ0+U3Baq+9NWuVCHroyuhP1jb4sYcvEepc9LFKUTK
qPqLStaxndTp0JPgj9T/CohtQW7xowQll9y9usfbzPTcURWN+g39HZQ5//kNd+rs
DuLfZy4Dnu3aw6HZgR97EtD9/b0QltnP+hKYX7H6mW2coiJulvl4KbvwUXpmH6kA
kUQgVcdtjma6C7Nsk9WnRvez+H7WIKayH7/EbsRpmQKBgQDinFMXFVXOPO81x8Md
Rii5iFCZf4+yHOIiXexz8nxMCp7yHywq/cokI2PyiM/Yuys2iLph0gN/AMAth2QZ
kNc4ATimD8N2+DC0LUub1jcfZNpXiDdNqqSpW1aIAUzljw3Ks5bWPTaYNhndLPiB
yVxwpTvd2IXznC40/oYCZrzmaQKBgQDFHMDU05hWW/X+lZu6gvKXDVEocwx3V09C
fL8Zgsm3fFhUVmTq/fg2EKeF3OMbMEo7eVFJif48r2lTfznkrv81YKGh5paMrD53
yDK0PIH6QJuqyrMHrrqTACYmxWrEfLe3v+oTyEF9IUhcpQf9b0TLK+0o18lPw/xt
kNsn5bS8uwKBgGPHw4pheZPDHu1GVXJ5Zwsyq5K7KVGbCDNruebf+b0d3Bjugus3
Lp+0+Zhch3B+EawEjlTuPV3ZvcUOXZQoQ6vEVeZBAKdM510eqLEopMLtDHsIXpmT
LsfnkPV35R0bXU5Iv3z8HSLuh3rtB0tWl55+Exs+8NRwi6QIAofiJwEpAoGBALzR
+nbl63xuw4uJTZCxeCny+9e/viVkYezTC00o2IsIdqTzzeC+QVOpSJEXNAcLj1DB
uniz0/PWJRNzQMYsTRWY57zr4zQGnCCqisfVXr2XvocxfabSXrAK6IEjhE+NGYDQ
Oy+QGgwAIg19mdXRDRmDjsAdVh8vI1Th+s6RYT2ZAoGAHYwBxNoCavUy3lM+1Bmm
TaRDTfprmtmnWaNpyLkZX0Bi0GsV/0nhUlogp1IpEiiB+KZeXEIpsRdRVk2gdgRf
YsPPZT5213Bbr6gX5bt02U86ChkWdJzHX5B/POO72/aMNwCF1MDBoI/1Y6lzleqm
qiPZz+PdAdgLmyu3UM9jLoA=
-----END PRIVATE KEY-----' \
  --name 'cloudflare_origin_key' \
  --vault-password-file /home/dimitri/.vault_pass.txt
